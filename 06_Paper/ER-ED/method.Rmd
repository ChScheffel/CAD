---
output: html_document
bibliography: ER_ED.bib
csl: apa7.csl
editor_options: 
  markdown: 
    wrap: sentence
---

```{r SetupMethod, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(targets)    # to keep track of all relevant files
library(readxl)     # import excel files
library(here)       # to set directories without defined paths
library(papaja)     # APA conform output
library(afex)       # for ANOVA
library(emmeans)
library(ggplot2)    # for nice plots
library(dplyr)
library(BayesFactor)
library(effectsize)

# set top level directory to source file
here::i_am("flag_project_root_CERED.txt")
```

```{r stimvalues, echo = FALSE}
# import excel list with neutral and negative pictures
# lists contain arousal and valence values of each picture
stim_negative = readxl::read_xlsx(file.path(here("01_Paradigms", "ER-ED", "ER_ED", "Stimuli", "negative.xlsx")), range = cell_cols("A:D"))

stim_neutral = readxl::read_xlsx(file.path(here("01_Paradigms", "ER-ED", "ER_ED", "Stimuli", "neutral.xlsx")), range = cell_rows(1:21))
```

```{r import, echo=FALSE, message=FALSE, warning=FALSE}
# import ER ratings and ER discounting data into lists

datalist_ER = lapply(list.files(here("04_RawData", "pilot", "ER-ED/logfiles"), pattern = '*_ER.*csv', full.names = TRUE),
                          read.csv, stringsAsFactors = FALSE, header = TRUE)
  
datalist_ED = lapply(list.files(here("04_RawData", "pilot", "ER-ED/logfiles"), pattern = '*_ED.*csv', full.names = TRUE),
                          read.csv, stringsAsFactors = FALSE, header = TRUE)

# new empty frame to store files into
data_ER = data.frame(ID = character(), block = character(), arousal = double(), 
                     effort = double(), trigger = double(), trigger_reg = double())

data_ED = data.frame(ID = character(), step = double(), choice = character(),
                     LBvalue = double(), LBlevel = double(), RBvalue = double(), RBlevel = double())

data_choice = data.frame(ID = character(), choice = double())

# store arousal and effort ratings in data_ER frame
for (i in 1:length(datalist_ER)) {
  
  tmp = data.frame(datalist_ER[[i]][["participant"]], 
                   datalist_ER[[i]][["instr_1"]], 
                   datalist_ER[[i]][["slider_arousal.response"]], 
                   datalist_ER[[i]][["slider_effort.response"]],
                   datalist_ER[[i]][["TriggerBlockView"]],
                   datalist_ER[[i]][["TriggerBlockReg"]])
  colnames(tmp) = names(data_ER)
  tmp = tmp[(!is.na(tmp$arousal)), ]
  
  data_ER = rbind(tmp, data_ER)
  
}

rownames(data_ER) = 1:nrow(data_ER)

# loop to store trigger in one column

for (i in 1:nrow(data_ER)) {
  if (is.na(data_ER$trigger[i])) {
    data_ER$trigger[i] = data_ER$trigger_reg[i]
  }
  
  if (is.na(data_ER$trigger[i])) {
    data_ER$trigger[i] = 26
  }
}

# delete old column

data_ER$trigger_reg = NULL

# loop to correct block indicator

data_ER$block[data_ER$trigger == 21] <- "1_view_neu"
data_ER$block[data_ER$trigger == 22] <- "2_view_neg"
data_ER$block[data_ER$trigger == 23] <- "3_distraction"
data_ER$block[data_ER$trigger == 24] <- "4_distancing"
data_ER$block[data_ER$trigger == 25] <- "5_suppression"
data_ER$block[data_ER$trigger == 26] <- "6_choice"

# store ER choice in data_choice frame

for (i in 1:length(datalist_ER)) {
  tmp = data.frame(datalist_ER[[i]][["participant"]], datalist_ER[[i]][["resp_choice.keys"]])
  colnames(tmp) = names(data_choice)
  tmp = tmp[(!is.na(tmp$choice)), ]
  
  data_choice = rbind(tmp, data_choice)
}

# store ED data in data_ED frame
#for (i in 1:length(datalist_ED)) {
  
#  tmp = data.frame(datalist_ED[[i]][["participant"]][2:length(datalist_ED[[i]][["participant"]])],
#                   datalist_ED[[i]][["EDround.thisN"]][2:length(datalist_ED[[i]][["EDround.thisN"]])],
#                   datalist_ED[[i]][["EDclick.clicked_name"]][2:length(datalist_ED[[i]][["EDclick.clicked_name"]])],
#                   datalist_ED[[i]][["EDleftbutton.value"]][2:length(datalist_ED[[i]][["EDleftbutton.value"]])],
#                   datalist_ED[[i]][["EDleftbutton.nback"]][2:length(datalist_ED[[i]][["EDleftbutton.nback"]])],
#                   datalist_ED[[i]][["EDrightbutton.value"]][2:length(datalist_ED[[i]][["EDrightbutton.value"]])],
#                   datalist_ED[[i]][["EDrightbutton.nback"]][2:length(datalist_ED[[i]][["EDrightbutton.nback"]])])
  
#  colnames(tmp) = names(data_ED)
#  data_ED = rbind(data_ED, tmp)
#}

# import EMG data

datalist_EMG <- lapply(list.files(here("04_RawData", "pilot", "ER-ED", "EMG", "analysis"), pattern = '*_Peaks.txt', full.names = TRUE),
                          read.table, stringsAsFactors = FALSE, header = TRUE)
datalist_EMG_Marker <- lapply(list.files(here("04_RawData", "pilot", "ER-ED", "EMG", "analysis"), pattern = "*.Markers", full.names = TRUE),
                              read.table, stringsAsFactors = FALSE, header = TRUE, skip = 1, row.names = NULL, sep = ",")

# new empty frame to store files into
data_EMG = data.frame(ID = character(), trigger = double(), Corr = double(), 
                     Lev = double())

# store EMG data in data_EMG frame
for (i in 1:length(datalist_EMG)) {
  
  tmp = data.frame(datalist_EMG[[i]][["Filename"]], 
                   datalist_EMG_Marker[[i]][["Description"]], 
                   datalist_EMG[[i]][["T0T6000Corr.ASNM"]], 
                   datalist_EMG[[i]][["T0T6000Lev.ASNM"]])
  colnames(tmp) = names(data_EMG)
  
  data_EMG = rbind(tmp, data_EMG)
  
}

# create variable "block"

data_EMG$block[data_EMG$trigger == " S 21"] <- "1_view_neu"
data_EMG$block[data_EMG$trigger == " S 22"] <- "2_view_neg"
data_EMG$block[data_EMG$trigger == " S 23"] <- "3_distraction"
data_EMG$block[data_EMG$trigger == " S 24"] <- "4_distancing"
data_EMG$block[data_EMG$trigger == " S 25"] <- "5_suppression"
data_EMG$block[data_EMG$trigger == " S 26"] <- "6_choice"


# import questionnaire df

data_quest = read.csv(here("04_RawData", "pilot", "ER-ED", "dfs", "df_quest.csv"), sep = ",")

```

```{r statistics, echo=FALSE, message=FALSE, warning=FALSE}
## Subjective arousal

# ANOVA subjective arousal ratings
# View condition

Ratings_view <- data_ER %>%
  subset(data_ER$block == "1_view_neu" | data_ER$block == "2_view_neg")
Ratings_view$block <- as.factor(Ratings_view$block)

SubjArousalView_aov <- afex::aov_ez(data = Ratings_view,
                               id = "ID",
                               dv = "arousal",
                               within = "block",
                               fun_aggregate = mean,
                               include_aov = TRUE) 

# compute posthoc tests for within measures
SubjArousalView_emm <- emmeans::emmeans(SubjArousalView_aov$aov, specs = "block")

SubjArousalView_con <- as.data.frame(pairs(SubjArousalView_emm, adjust = "bonferroni"))

# Bayes Factors
SubjArousalView_BF <- BayesFactor::anovaBF(formula = arousal ~ block,
                                           data = Ratings_view,
                                           progress = FALSE)
SubjArousalView_con$BF10 <- BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_view$arousal[Ratings_view$block == "1_view_neu"],
                                                                        y = Ratings_view$arousal[Ratings_view$block == "2_view_neg"],
                                                                        progress = FALSE, paired = TRUE))$bf

SubjArousalView_con <- cbind(SubjArousalView_con,
                             format(effectsize::t_to_eta2(t = SubjArousalView_con$t.ratio,
                                                          df_error = SubjArousalView_con$df,
                                                          ci = 0.95),
                                                          digits = 2))

colnames(SubjArousalView_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")
# rename contrast for table
SubjArousalView_con[1,1] <- "$View_{neutral} - View_{negative}$"

# Figure to visualize arousal ratings

# figure
FigSubjArousalViewPilot=ggplot2::ggplot(Ratings_view, aes(x = block, y = arousal))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Active viewing", 
                   limits = c("1_view_neu", "2_view_neg"),
                   labels = c("Neutral", "Negative"))+
  geom_jitter(size = 0.4)+
  labs(y = "Arousal Rating")

# View neg and regulate conditions 

Ratings_reg <- data_ER %>%
  subset(data_ER$block != "1_view_neu" & data_ER$block != "6_choice")
Ratings_reg$block <- as.factor(Ratings_reg$block)


SubjArousalReg_aov <- afex::aov_ez(data = Ratings_reg,
                              id = "ID",
                              dv = "arousal",
                              within = "block",
                              fun_aggregate = mean,
                              include_aov = TRUE)

# compute posthoc tests for within measures
SubjArousalReg_emm <- emmeans::emmeans(SubjArousalReg_aov$aov, specs = "block")

SubjArousalReg_con <- as.data.frame(pairs(SubjArousalReg_emm, adjust = "bonferroni"))

# Bayes Factors
SubjArousalReg_BF <- BayesFactor::anovaBF(formula = arousal ~ block,
                                          data = Ratings_reg,
                                          progress = FALSE)

SubjArousalReg_con$BF10 <- c(BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "2_view_neg"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "3_distraction"],
                                                                         progress = FALSE, paired = TRUE))$bf,
                             BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "2_view_neg"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "4_distancing"],
                                                                         progress = FALSE, paired = TRUE))$bf,
                             BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "2_view_neg"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "5_suppression"],
                                                                         progress = FALSE, paired = TRUE))$bf,
                             BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "3_distraction"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "4_distancing"],
                                                                         progress = FALSE, paired = TRUE))$bf,
                             BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "3_distraction"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "5_suppression"],
                                                                         progress = FALSE, paired = TRUE))$bf,
                             BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$arousal[Ratings_reg$block == "4_distancing"],
                                                                         y = Ratings_reg$arousal[Ratings_reg$block == "5_suppression"],
                                                                         progress = FALSE, paired = TRUE))$bf)

SubjArousalReg_con <- cbind(SubjArousalReg_con,
                            format(effectsize::t_to_eta2(t = SubjArousalReg_con$t.ratio,
                                                         df_error = SubjArousalReg_con$df,
                                                         ci = 0.95),
                                   digits = 2))

colnames(SubjArousalReg_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")

SubjArousalReg_con[1,1] <- "$View_{negative} - Distraction$"
SubjArousalReg_con[2,1] <- "$View_{negative} - Distancing$"
SubjArousalReg_con[3,1] <- "$View_{negative} - Suppression$"
SubjArousalReg_con[4,1] <- "$Distraction - Distancing$"
SubjArousalReg_con[5,1] <- "$Distraction - Suppression$"
SubjArousalReg_con[6,1] <- "$Distancing - Suppression$"

# Figure to visualize arousal ratings

# figure
FigSubjArousalRegPilot <- ggplot2::ggplot(Ratings_reg, aes(x = block, y = arousal))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Strategy", 
                   limits = c("2_view_neg", "3_distraction", "4_distancing", "5_suppression"),
                   labels = c("View", "Distraction", "Distancing", "Suppression"))+
  geom_jitter(size = 0.4)+
  labs(y = "Arousal Rating")

## Subjective effort

SubjEffort_aov <- afex::aov_ez(data = Ratings_reg,
                          id = "ID",
                          dv = "effort",
                          within = "block",
                          fun_aggregate = mean,
                          include_aov = TRUE)

# compute posthoc tests for within measure
SubjEffort_emm <- emmeans::emmeans(SubjEffort_aov$aov, specs = "block")

SubjEffort_con <- as.data.frame(pairs(SubjEffort_emm, adjust = "bonferroni"))

# Bayes Factors
SubjEffort_BF <- BayesFactor::anovaBF(formula = effort ~ block,
                                           data = Ratings_reg,
                                           progress = FALSE)

SubjEffort_con$BF10 <- c(BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "2_view_neg"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "3_distraction"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "2_view_neg"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "4_distancing"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "2_view_neg"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "3_distraction"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "4_distancing"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "3_distraction"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = Ratings_reg$effort[Ratings_reg$block == "4_distancing"],
                                                                     y = Ratings_reg$effort[Ratings_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf)

SubjEffort_con <- cbind(SubjEffort_con,
                        format(effectsize::t_to_eta2(t = SubjEffort_con$t.ratio,
                                                         df_error = SubjEffort_con$df,
                                                         ci = 0.95),
                               digits = 2))

colnames(SubjEffort_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")

SubjEffort_con[1,1] <- "$View_{negative} - Distancing$"
SubjEffort_con[2,1] <- "$View_{negative} - Distraction$"
SubjEffort_con[3,1] <- "$View_{negative} - Suppression$"
SubjEffort_con[4,1] <- "$Distraction - Distancing$"
SubjEffort_con[5,1] <- "$Distraction - Suppression$"
SubjEffort_con[6,1] <- "$Distancing - Suppression$"

# Figure to visualize effort ratings
# figure
FigSubjEffortPilot = ggplot2::ggplot(Ratings_reg, aes(x = block, y = effort))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Strategy", 
                   limits = c("2_view_neg", "3_distraction", "4_distancing", "5_suppression"),
                   labels = c("View", "Distraction", "Distancing", "Suppression"))+
  geom_jitter(size = 0.4)+
  labs(y = "Effort Rating")


### EMG

# effect of valence on EMG
# corrugator

EMG_view <- data_EMG %>%
  subset(data_EMG$block == "1_view_neu" | data_EMG$block == "2_view_neg")
EMG_view$block <- as.factor(EMG_view$block)

EMGCorrView_aov <- afex::aov_ez(data = EMG_view,
                               id = "ID",
                               dv = "Corr",
                               within = "block",
                               fun_aggregate = mean,
                               include_aov = TRUE)

# compute posthoc tests for within measures
EMGCorrView_emm <- emmeans::emmeans(EMGCorrView_aov$aov, specs = "block")

EMGCorrView_con <- as.data.frame(pairs(EMGCorrView_emm, adjust = "bonferroni"))

# Bayes Factors
EMGCorrView_BF <- BayesFactor::anovaBF(formula = Corr ~ block,
                                       data = EMG_view,
                                       progress = FALSE)
EMGCorrView_con$BF10 <- BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_view$Corr[EMG_view$block == "1_view_neu"],
                                                                    y = EMG_view$Corr[EMG_view$block == "2_view_neg"],
                                                                    progress = FALSE, paired = TRUE))$bf

EMGCorrView_con <- cbind(EMGCorrView_con,
                         format(effectsize::t_to_eta2(t = EMGCorrView_con$t.ratio,
                                                          df_error = EMGCorrView_con$df,
                                                          ci = 0.95),
                                                          digits = 2))

colnames(EMGCorrView_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")
# rename contrast for table
EMGCorrView_con[1,1] <- "$View_{neutral} - View_{negative}$"

# Figure to visualize arousal ratings

# figure
FigEMGCorrViewPilot=ggplot2::ggplot(EMG_view, aes(x = block, y = Corr))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Active viewing", 
                   limits = c("1_view_neu", "2_view_neg"),
                   labels = c("Neutral", "Negative"))+
  geom_jitter(size = 0.4)+
  labs(y = "Corrugator activity")

# levator

EMGLevView_aov <- afex::aov_ez(data = EMG_view,
                               id = "ID",
                               dv = "Lev",
                               within = "block",
                               fun_aggregate = mean,
                               include_aov = TRUE)

# compute posthoc tests for within measures
EMGLevView_emm <- emmeans::emmeans(EMGLevView_aov$aov, specs = "block")

EMGLevView_con <- as.data.frame(pairs(EMGLevView_emm, adjust = "bonferroni"))

# Bayes Factors
EMGLevView_BF <- BayesFactor::anovaBF(formula = Lev ~ block,
                                       data = EMG_view,
                                       progress = FALSE)
EMGLevView_con$BF10 <- BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_view$Lev[EMG_view$block == "1_view_neu"],
                                                                   y = EMG_view$Lev[EMG_view$block == "2_view_neg"],
                                                                   progress = FALSE, paired = TRUE))$bf

EMGLevView_con <- cbind(EMGLevView_con,
                        format(effectsize::t_to_eta2(t = EMGLevView_con$t.ratio,
                                                     df_error = EMGLevView_con$df,
                                                     ci = 0.95),
                                                     digits = 2))

colnames(EMGLevView_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")
# rename contrast for table
EMGLevView_con[1,1] <- "$View_{neutral} - View_{negative}$"

# Figure to visualize arousal ratings

# figure
FigEMGLevViewPilot=ggplot2::ggplot(EMG_view, aes(x = block, y = Lev))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Active viewing", 
                   limits = c("1_view_neu", "2_view_neg"),
                   labels = c("Neutral", "Negative"))+
  geom_jitter(size = 0.4)+
  labs(y = "Levator activity")

# effect of strategy on EMG

EMG_reg <- data_EMG %>%
  subset(data_EMG$block != "1_view_neu" & data_EMG$block != "6_choice")
EMG_reg$block <- as.factor(EMG_reg$block)

# corrugator
EMGCorrReg_aov <- afex::aov_ez(data = EMG_reg,
                              id = "ID",
                              dv = "Corr",
                              within = "block",
                              fun_aggregate = mean,
                              include_aov = TRUE)

# compute posthoc tests for within measures
EMGCorrReg_emm <- emmeans::emmeans(EMGCorrReg_aov$aov, specs = "block")

EMGCorrReg_con <- as.data.frame(pairs(EMGCorrReg_emm, adjust = "bonferroni"))

# Bayes Factors
EMGCorrReg_BF <- BayesFactor::anovaBF(formula = Corr ~ block,
                                      data = EMG_reg,
                                      progress = FALSE)

EMGCorrReg_con$BF10 <- c(BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "2_view_neg"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "3_distraction"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "2_view_neg"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "4_distancing"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "2_view_neg"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "3_distraction"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "4_distancing"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "3_distraction"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf,
                         BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Corr[EMG_reg$block == "4_distancing"],
                                                                     y = EMG_reg$Corr[EMG_reg$block == "5_suppression"],
                                                                     progress = FALSE, paired = TRUE))$bf)

EMGCorrReg_con <- cbind(EMGCorrReg_con,
                        format(effectsize::t_to_eta2(t = EMGCorrReg_con$t.ratio,
                                                     df_error = EMGCorrReg_con$df,
                                                     ci = 0.95),digits = 2))

colnames(EMGCorrReg_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")

EMGCorrReg_con[1,1] <- "$View_{negative} - Distraction$"
EMGCorrReg_con[2,1] <- "$View_{negative} - Distancing$"
EMGCorrReg_con[3,1] <- "$View_{negative} - Suppression$"
EMGCorrReg_con[4,1] <- "$Distraction - Distancing$"
EMGCorrReg_con[5,1] <- "$Distraction - Suppression$"
EMGCorrReg_con[6,1] <- "$Distancing - Suppression$"

# Figure to visualize arousal ratings

# figure
FigEMGCorrRegPilot <- ggplot2::ggplot(EMG_reg, aes(x = block, y = Corr))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Strategy", 
                   limits = c("2_view_neg", "3_distraction", "4_distancing", "5_suppression"),
                   labels = c("View", "Distraction", "Distancing", "Suppression"))+
  geom_jitter(size = 0.4)+
  labs(y = "Corrugator activity")

# levator

EMGLevReg_aov <- afex::aov_ez(data = EMG_reg,
                              id = "ID",
                              dv = "Lev",
                              within = "block",
                              fun_aggregate = mean,
                              include_aov = TRUE)

# compute posthoc tests for within measures
EMGLevReg_emm <- emmeans::emmeans(EMGLevReg_aov$aov, specs = "block")

EMGLevReg_con <- as.data.frame(pairs(EMGLevReg_emm, adjust = "bonferroni"))

# Bayes Factors
EMGLevReg_BF <- BayesFactor::anovaBF(formula = Lev ~ block,
                                      data = EMG_reg,
                                      progress = FALSE)

EMGLevReg_con$BF10 <- c(BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "2_view_neg"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "3_distraction"],
                                                                    progress = FALSE, paired = TRUE))$bf,
                        BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "2_view_neg"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "4_distancing"],
                                                                    progress = FALSE, paired = TRUE))$bf,
                        BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "2_view_neg"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "5_suppression"],
                                                                    progress = FALSE, paired = TRUE))$bf,
                        BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "3_distraction"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "4_distancing"],
                                                                    progress = FALSE, paired = TRUE))$bf,
                        BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "3_distraction"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "5_suppression"],
                                                                    progress = FALSE, paired = TRUE))$bf,
                        BayesFactor::extractBF(BayesFactor::ttestBF(x = EMG_reg$Lev[EMG_reg$block == "4_distancing"],
                                                                    y = EMG_reg$Lev[EMG_reg$block == "5_suppression"],
                                                                    progress = FALSE, paired = TRUE))$bf)

EMGLevReg_con <- cbind(EMGLevReg_con,
                       format(effectsize::t_to_eta2(t = EMGLevReg_con$t.ratio,
                                                    df_error = EMGLevReg_con$df,
                                                    ci = 0.95),digits = 2))

colnames(EMGLevReg_con) <- c("Contrast", "Estimate", "$SE$", "$df$", "$t$", "$p$", "$BF10$", "$\\eta_{p}^{2}$", "$95\\% CI$")

EMGLevReg_con[1,1] <- "$View_{negative} - Distraction$"
EMGLevReg_con[2,1] <- "$View_{negative} - Distancing$"
EMGLevReg_con[3,1] <- "$View_{negative} - Suppression$"
EMGLevReg_con[4,1] <- "$Distraction - Distancing$"
EMGLevReg_con[5,1] <- "$Distraction - Suppression$"
EMGLevReg_con[6,1] <- "$Distancing - Suppression$"

# Figure to visualize arousal ratings

# figure
FigEMGLevRegPilot <- ggplot2::ggplot(EMG_reg, aes(x = block, y = Lev))+
  geom_boxplot(width = 0.7, position = position_dodge(0.8))+
  scale_x_discrete(name = "Strategy", 
                   limits = c("2_view_neg", "3_distraction", "4_distancing", "5_suppression"),
                   labels = c("View", "Distraction", "Distancing", "Suppression"))+
  geom_jitter(size = 0.4)+
  labs(y = "Levator activity")

```

# 2. Method

The R Markdown file used to analyze the data and write this document, as well as the raw data and the materials are freely available at github.com/ChScheffel/COG-ER-ED.
According to the 21-word-solution, "we report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study" in compliance with the 21-word-solution of open science [@Simmons2012].
A complete list of all measures assessed in the study will be found at the OSF (<https://osf.io/vnj8x/>) and GitHub (github.com/ChScheffel/COG-ER-ED).
<!-- Attention! OSF is still private --> All procedures performed in this study were in accordance with the ethical standards of the institutional and/or national research committee and with the 1964 Helsinki declaration and its later amendments or comparable ethical standards.

## 2.1 Ethics information

## 2.2 Pilot data

The procedure described above was tested in a pilot study with $N=`r nrow(data_quest)`$ participants (`r length(which(data_quest$gender == 2))` female; age: $M = `r round(mean(data_quest[,"age"], na.rm = TRUE), digits = 1)`\text{ }\pm\text{ }SD = `r round(sd(data_quest[,"age"], na.rm = TRUE), digits = 1)`$).
Results showed significant higher subjective (... and physiological ?!) arousal for active viewing of negative pictures, compared to active viewing of neutral pictures.
However, ER strategies could not reduce subjective arousal compared to active viewing of negative pictures.
Yet we found accordance with our previous studies [@Scheffel2021] that the use of ER strategies compared to active viewing was associated with increased subjective effort.


## 2.3 Design

Young, healthy participants (aged 18 to 30 years) will be recruited using the software *ORSEE* [@Greiner2015] at the Technische Universität Dresden.
Participants will be invited to fill out an online survey containing different questionnaires to assess broad and narrow personality traits and measures of well-being.
The study consists of two lab sessions, which take place in a shielded cabin with constant lighting.
Before each session, participants receive information about the respective experimental procedure and provide informed consent.
At the beginning of the first session participants fill out a demographic questionnaire and complete an n-Back task with the levels one to four.
Then, they complete an ED procedure on screen, followed by a random repetition of one n-back level.
<!--JZ: Hast du ED schon als Abkürzung eingeführt?--> The second session, containing the ER paradigm, takes place exactly one week after session one.
Participants provide informed consent and receive written instructions on the ER paradigm and ER strategies that they should apply.
A brief training ensures that all participants are able to implement the ER strategies.
Next, electrodes to measure EMG are being attached and the ER paradigm is conducted.
Participants receive 30.00€ or course credit as compensation.
Study data are being collected and managed using REDCap electronic data capture tools hosted at Technische Universität Dresden [@Harris2009; @Harris2019].

### 2.3.1 Psychometric measures

The online survey contains a number of questionnaires: General psychological well-being is assessed using the German version of the WHO-5 scale [@Bech2004; @Braehler2007].
To capture the construct of resilience, the German version 10-item-form of the Connor-Davidson resilience Scale (CD-RISC)[@Connor2003,@Campbell-Sills2007; @Sarubin2015] is used.
Dispositional use of ER is assessed using the German version of the Emotion Regulation Questionnaire (ERQ) [@GrossJohn2003; @Abler2009].
For the assessment of ER ability we use the Flexible Emotion Regulation Scale (FlexER) [@Doerfel2019].
Implicit theories of willpower in emotion control are assessed using the implicit theories questionnaire from @Bernecker2017.
To assess Need for Cognition, the German version short form of the Need for Cognition Scale [@Cacioppo1982; @Bless1994] is used.
To assess self-control, sum scores of the German versions of the following questionnaires are used [@Paschke2016]: the Self-Regulation Scale (SRS) [@Schwarzer1999], the Brief Self-Control Scale (BSCS) @Tangney2004; @Sproesser2011], and the Barratt Impulsiveness Scale (BIS-11) [@Patton1995; @Hartmann2011].
Attentional control is assessed using the Attentional Control Scale (ACS) [@Derryberry2002].

### 2.3.2 Emotion regulation paradigm

The ER paradigm roughly consists of three parts that will be described in the following.

*Part one: ER task.* <br> Part one is a standard ER task in a block design (see Figure X), similar to paradigms previously used by our group [@Scheffel2021].
Participants are told to actively view neutral and negative pictures (see [2.3.3](##stimuli)) or to regulate all upcoming emotions by means of distraction, distancing, and expressive suppression, respectively.
Every participant first has the condition "active viewing-neutral" that serves as a baseline condition.
During this block, 20 neutral pictures are presented.
Participants are asked to "actively view all pictures and permit all emotions that may arise." In the second block, participants actively viewe negative pictures.
During the third, fourth, and fifth block, participants see negative pictures and are asked to regulate their emotions using distraction, distancing, and suppression.
In order to achieve distraction, participants are asked to think of a geometric object or an everyday activity, like brushing their teeth.
During distancing, participants are asked to "take the position of a non-involved observer, thinking about the picture in a neutral way." Participants are told not to re-interpret the situation or attaching a different meaning to the situation.
During suppression, participants are told to "suppress their emotional facial expression." They should imagine being observed by a third person that should not be able to tell just by looking at the facial expression whether the person is looking at an emotional picture.
Participants are instructed not to suppress their thoughts or change their facial expression to the opposite [@Scheffel2021].
All participants receive written instruction and complete a training session.
After the training session, participants are asked about their applied ER strategies to avoid misapplication.
The order of the three regulation blocks (distraction, distancing, and suppression) is randomized between participants.

*Part two: ER effort discounting.* <br> In the second part, ER effort discounting takes place.
The procedure of the discounting follows the COG-ED paradigm by Westbrook et al. [-@Westbrook2013] with major change.
We use the following adaption that allows the computation of SVs for different strategies without presuming that all individuals would inherently evaluate the same strategy as the easiest one: For each possible pairing (distraction vs. distancing, distraction vs. suppression, and distancing vs. suppression), two strategies with monetary values are presented.
The order of the comparisons is randomized.
Because there is no strategy that is objectively more difficult, we added an initial comparison that begins with the option "1 EUR for strategy A or 1 EUR for strategy B".
The strategy that is not chosen is assigned the value of 2 EUR.
From this point on, comparisons between strategies follow the original COG-ED paradigm [@Westbrook2013].
Participants are instructed to decide as realistically as possible, imagining the displayed money would really be up for election.

*Part three: ER choice.* <br> After the discounting part, participants choose which of the three ER strategies (distraction, distancing or suppression) they want to re-apply.
Importantly, there are no further instruction on what basis they should make their decision.
Participants should make their decision freely, according to the criteria they consider important for themselves.
However, participants are asked to state the reasons for the decision afterwards.
As soon as they have decided, they see the respective instruction and the block with another 20 negative pictures starts.

### 2.3.3 Stimuli

Pictures used in the paradigm were selected from the Emotional Picture Set (EmoPicS) [@Wessa2010] and the International Affective Picture System (IAPS) [@Lang2008].
The 20 neutral pictures (Valence (V): *M* $\pm$ *SD* = `r round(mean(stim_neutral$valence), digits = 2)` $\pm$ `r round(sd(stim_neutral$valence), digits = 2)`; Arousal (A): *M* $\pm$ *SD* = `r round(mean(stim_neutral$arousal), digits = 2)` $\pm$ `r round(sd(stim_neutral$arousal), digits = 2)`) depicted content related to the categories persons, objects, and scenes.
Further, 100 negative pictures, featuring categories animals, body, disaster, disgust, injury, suffering, violence, and weapons, were used.
An evolutionary algorithm [@Yu2010] was used to cluster these pictures into five sets with comparable valence and arousal values (set one: V: *M* $\pm$ *SD* = `r round(mean(stim_negative$valence[stim_negative$set == 1]), digits = 2)` $\pm$ `r round(sd(stim_negative$valence[stim_negative$set == 1]), digits = 2)`, A: *M* $\pm$ *SD* = `r round(mean(stim_negative$arousal[stim_negative$set == 1]), digits = 2)` $\pm$ `r round(sd(stim_negative$arousal[stim_negative$set == 1]), digits = 2)`; set two: V: *M* $\pm$ *SD* = `r round(mean(stim_negative$valence[stim_negative$set == 2]), digits = 2)` $\pm$ `r round(sd(stim_negative$valence[stim_negative$set == 2]), digits = 2)`, A: *M* $\pm$ *SD* = `r round(mean(stim_negative$arousal[stim_negative$set == 2]), digits = 2)` $\pm$ `r round(sd(stim_negative$arousal[stim_negative$set == 2]), digits = 2)`; set three: V: *M* $\pm$ *SD* = `r round(mean(stim_negative$valence[stim_negative$set == 3]), digits = 2)` $\pm$ `r round(sd(stim_negative$valence[stim_negative$set == 3]), digits = 2)`, A: *M* $\pm$ *SD* = `r round(mean(stim_negative$arousal[stim_negative$set == 3]), digits = 2)` $\pm$ `r round(sd(stim_negative$arousal[stim_negative$set == 3]), digits = 2)`; set four: V: *M* $\pm$ *SD* = `r round(mean(stim_negative$valence[stim_negative$set == 4]), digits = 2)` $\pm$ `r round(sd(stim_negative$valence[stim_negative$set == 4]), digits = 2)`, A: *M* $\pm$ *SD* = `r round(mean(stim_negative$arousal[stim_negative$set == 4]), digits = 2)` $\pm$ `r round(sd(stim_negative$arousal[stim_negative$set == 4]), digits = 2)`; set five: V: *M* $\pm$ *SD* = `r round(mean(stim_negative$valence[stim_negative$set == 5]), digits = 2)` $\pm$ `r round(sd(stim_negative$valence[stim_negative$set == 5]), digits = 2)`, A: *M* $\pm$ *SD* = `r round(mean(stim_negative$arousal[stim_negative$set == 5]), digits = 2)` $\pm$ `r round(sd(stim_negative$arousal[stim_negative$set == 5]), digits = 2)`).
A complete list of all pictures and their classification into sets can be found in supplementary material X.

### 2.3.4 Electromyography

Two bipolar electromyograph (EMG) measures will be recorded in the region of the *corrugator supercilii* and the *levator labii* using Brain Vision Recorder (Brain Products Inc., Gilching, Germany).
Passive surface Ag/AgCl electrodes (0.7 mm diameter, 10 mm distance between electrodes) filled with electrolyte gel will be used.
Data will be sampled at 1000 Hz.
To measure *corrugator EMG*, electrodes will be applied to the abraded and cleaned skin on the left *corrugator supercilii*, and to measure *levator EMG*, electrodes were applied in the region of the *levator labii*.
The ground electrode will be placed at the left *Mastoid*.
A 20 Hz high pass (order 8), a 300 Hz low pass (order 8), and a 50 Hz notch filter will be applied to both signals.
Afterwards, the signals will be rectified and segmented.
EMG data will be baseline-corrected to -200 ms to 0 ms to stimulus onset.
Last, the sampling rate is changed to 100 Hz and the AUC for the interval of 6000 ms stimulus presentation extracted for every stimulus.
<!-- Liebe @Anne, habe das aus dem Analyzer zusammengefasst, stimmt das? -- -->

## 2.4 Sampling plan

Participants will be healthy adults in the age of 18 to 30, recruited using the software *ORSEE* [@Greiner2015] at the Technische Universität Dresden.
<!--JZ: Das stand oben schon mal--> Participants will be excluded from participation if they do not fluently speak German, have current or a history of psychological disorders or neurological trauma, or report to take medication.
Sample size calculation is done using *G\*Power* [@Faul2007; @Faul2009].
In a meta-analysis of Zaehringer and colleagues [-@Zaehringer2020], effect sizes of ER on peripheral-physiological measures were reported.
To find an effect of $d=-0.32$ of ER on *corrugator* muscle activity with $\alpha=.05$ and $\beta=.95$, data of least $N=85$ have to be analyzed.
Power analyses of all other hypotheses yielded smaller sample sizes.
However, if participants withdraw from study participation, technical failures occur, or experimenter considers the participant for not suitable for study participation (e.g., because the participant does not follow instructions or shows great fatigue), respective data will also be excluded from further analyses.
Therefore, we aim to collect data of 90 participants.

## 2.5 Analysis plan

All statistical analyses will be performed using *RStudio* (version 1.4.1717) [@RStudioTeam2020]and *R* (version 4.1.0) [@RCore2021] for Windows.
The level of significance was set to $\alpha=.05$.

*Effects of emotion regulation on arousal and effort* <br> To examine impact of valence of emotional pictures on subjective arousal, an repeated measures analysis of variance (rmANOVA) with the factor valence (neutral and negative) for strategy active viewing will be conducted for behavioral data (subjective arousal ratings).
To investigate the effect of the tree ER strategies on subjective arousal, another rmANOVA was conducted with the factor strategy (active viewing, distraction, distancing, and suppression) for subjective arousal ratings of negative pictures.
To examine the impact of valence on the emotional facial reaction, an rmANOVA with the factor valence (neutral and negative) for strategy active viewing was conducted for EMG activity of *corrugator* and *levator*.
<!-- @Anne please check! =) --> A further rmANOVA with the factor strategy (active viewing, distraction, distancing, and suppression) was conducted for EMG activity to examine the effects of ER strategies on the emotional facial reaction.
<!-- @Anne please check! =) --> To examine the effect of ER strategies on cognitive effort, an rmANOVA with the factor strategy (active viewing, distraction, distancing, and suppression) for subjective effort ratings was conducted.
Greenhouse-Geisser-corrected $p$-values and degrees of freedom were reported when assumption of sphericity was violated.
Proportion of explained variance $\eta_{p}^{2}$ was reported as a measure of effect size.
If indicated by the data, estimated marginal means will be computed as post-hoc contrasts.

*Subjective values of emotion regulation strategies* <br> For each ER strategy, SVs were calculated as follows: first, the value 0.015625 was added to or subtracted from the last monetary value of the flexible strategy, depending on the participant's last choice.
Second, the resulting (monetary) value will be divided by 2.00 €.
The final SV for each participant will be computed by averaging all final SVs of each strategy.
The resulting values will be entered in a rmANOVA to compare the SVs of the three strategies (distraction, distancing, and suppression) to explore for group effects.
Again, estimated, marginal means will be computed as post-hoc contrasts.

To investigate, whether individual SVs predict ER choice, a Chi-squared test with predicted choice (highest SV of each participant) and actual choice will be computed.
Furthermore, an ordinal logistic regression with dependent variable choice and independent variables SVs of each strategy will be computed.

To explore the association between subjective arousal, physiological arousal, and subjective effort on SVs, a multilevel model (MLM) will be specified using the $lmerTest$ package [@Kuznetsova2017].
First, ER strategies will be re-coded and centered for each subject according to their individual SVs: The strategy with the highest SV will be coded as -1, the strategy with the second highest SV 0, and the strategy with the lowest SV will be coded as 1.
Restricted maximum likelihood (REML) will be applied to fit the model.
A random slopes model of SVs including subjective effort (effort ratings), subjective arousal (arousal ratings), and physiological arousal (*corrugator* activity and *levator* activity) as level-1-predictor will be specified.
$$
SV \sim strategy\ + \text{effort rating} + \text{arousal rating} + corrugator \text{ activity} + levator \text{ activity} + (strategy|subject)
$$ Level-1-predictors will be centered within cluster [@Enders2007].
Residuals of the final model will be inspected visually.
Intraclass correlation coefficient (ICC), $\rho$, will be reported for each model (null model, as well as full model).

The influence of personality traits on SVs will be investigated exploratorily.
Therefore, the MLM specified above will be extended by the level-2-predictors NFC and self-control.
<!--CS: Weitere Persönlichkeitsfaktoren ins Modell? Würde sagen erstmal nicht, denn sonst wird es a) überladen mit Prädiktoren und b) haben wir sonst kein Maß, was meiner Meinung nach mit ALLEN SVs zusammenhängen sollte. -->

The association between flexible ER and SVs of ER strategies will be investigated with a regression using the $intercept$ and $slope$ of each participants' SVs to predict threir FlexER score.
Therefore, SVs will be ordered by magnitude firstly.
Secondly, for each participant a linear model will be built to estimate the individual $intercept$ and $slope$.
<!--CS: Reicht das so als Beschreibung und wird klar, woher die Slopes und Intercepts kommen werden? -->

For each result of the analyses both, $p$-values and Bayes factor $BF10$, calculated using the *BayesFactor* package [@Morey2021], will be reported.

## Data availability

The data of this study can be downloaded from [osf.io/vnj8x/](https://osf.io/vnj8x/).

## Code availability

The paradigm code, as well as the R Markdown file used to analyze the data and write this document is available at our [Github repository](https://github.com/ChScheffel/CERED).
